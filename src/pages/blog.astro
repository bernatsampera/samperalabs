---
import PageLayout from '../layouts/PageLayout.astro';
import {getDB} from '../lib/db';

// Fetch posts from database instead of files
const db = getDB();
const allPosts = db.getAllPosts();

const metadata = {
  title: 'Writing | Bernat Sampera',
  description: 'Thoughts on design, development, and the intersection of technology and creativity.',
};
---

<PageLayout metadata={metadata}>
  <div class="min-h-screen bg-background">
    <!-- Blog Header -->
    <header class="border-b border-border">
      <div class="container mx-auto px-6 py-12 max-w-4xl">
        <h1 class="text-4xl md:text-6xl font-bold text-foreground mb-4">Writing</h1>
        <p class="text-lg text-muted-foreground max-w-2xl mb-6">
          Thoughts on design, development, and the intersection of technology and creativity.
        </p>
        <a href="/tags" class="text-foreground hover:text-muted-foreground transition-colors font-medium">
          Browse by tags →
        </a>
      </div>
    </header>

    <!-- Blog Content -->
    <main class="container mx-auto px-6 py-16 max-w-4xl">
  <!-- Post Creation Button -->
  <div class="mb-12">
    <a 
      href="/admin/new-post" 
      class="inline-flex items-center px-6 py-3 bg-primary text-primary-foreground hover:bg-primary/90 transition-colors border border-border rounded-sm font-medium"
    >
      New Post
    </a>
  </div>

  <!-- Posts Grid -->
  {allPosts.length === 0 ? (
    <div class="text-center py-16">
      <p class="text-muted-foreground text-lg mb-6">No posts yet.</p>
      <a 
        href="/admin/new-post" 
        class="inline-flex items-center px-8 py-4 bg-primary text-primary-foreground hover:bg-primary/90 transition-colors border border-border rounded-sm font-medium"
      >
        Write your first post
      </a>
    </div>
  ) : (
    <div class="space-y-16">
      {allPosts.map((post) => (
        <article class="group">
          <div class="space-y-4">
            <!-- Post Date -->
            <time class="text-sm text-muted-foreground">
              {new Date(post.pub_date).toLocaleDateString('en-US', { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
              })}
            </time>
            
            <!-- Post Title -->
            <h2 class="text-2xl md:text-3xl font-bold text-foreground group-hover:text-muted-foreground transition-colors">
              <a href={`/posts/${post.slug}`} class="block">
                {post.title}
              </a>
            </h2>
            
            <!-- Post Description -->
            {post.description && (
              <p class="text-muted-foreground text-lg leading-relaxed max-w-3xl">
                {post.description}
              </p>
            )}
            
            <!-- Post Meta -->
            <div class="flex items-center gap-4 text-sm text-muted-foreground">
              <span>By {post.author}</span>
              {post.tags && post.tags.length > 0 && (
                <div class="flex items-center gap-2">
                  <span>•</span>
                  <div class="flex gap-2">
                    {post.tags.slice(0, 3).map((tag) => (
                      <span class="px-2 py-1 bg-muted text-muted-foreground rounded-sm text-xs">
                        {tag}
                      </span>
                    ))}
                    {post.tags.length > 3 && (
                      <span class="text-xs">+{post.tags.length - 3} more</span>
                    )}
                  </div>
                </div>
              )}
            </div>
            
            <!-- Read More Link -->
            <div class="pt-2">
              <a 
                href={`/posts/${post.slug}`} 
                class="text-foreground hover:text-muted-foreground transition-colors font-medium"
              >
                Read more →
              </a>
            </div>
          </div>
        </article>
      ))}
    </div>
  )}
    </main>
  </div>
</PageLayout>