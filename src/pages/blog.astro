---
import PostCard from '~/components/common/PostCard.astro';
import PageLayout from '../layouts/PageLayout.astro';
import {getDB} from '../lib/db';

// Fetch posts from database instead of files
const db = getDB();
const allPosts = db.getAllPosts();

const metadata = {
  title: 'Blog | Bernat Sampera',
  description: 'Thoughts on design, development, and the intersection of technology and creativity.',
};
---

<PageLayout metadata={metadata}>
  <div class="min-h-screen bg-background">
    <!-- Blog Header -->
    <header class="border-b">
      <div class="container mx-auto px-6 py-12 max-w-4xl">
        <h1 class="text-4xl md:text-6xl font-bold text-foreground mb-4">Blog</h1>
        <p class="text-lg text-muted-foreground max-w-2xl mb-6">
          Thoughts on design, development, and the intersection of technology and creativity.
        </p>
        <a href="/tags" class="text-foreground hover:text-muted-foreground transition-colors font-medium">
          Browse by tags â†’
        </a>
      </div>
    </header>

    <!-- Blog Content -->
    <main class="container mx-auto px-6 py-16 max-w-4xl">
      <!-- Post Creation Button -->
      <div id="new-post-button" class="mb-12 hidden">
        <a
          href="/admin/new-post"
          class="inline-flex items-center px-6 py-3 bg-primary-foreground hover:bg-primary/90 transition-colors border rounded-sm font-medium"
        >
          New Post
        </a>
      </div>

      <!-- Posts Grid -->
      {
        allPosts.length === 0 ? (
          <div class="text-center py-16">
            <p class="text-muted-foreground text-lg mb-6">No posts yet.</p>
            <a
              id="first-post-button"
              href="/admin/new-post"
              class="inline-flex items-center px-8 py-4 bg-primary-foreground hover:bg-primary/90 transition-colors border  rounded-sm font-medium hidden"
            >
              Write your first post
            </a>
          </div>
        ) : (
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            {allPosts.map((post) => (
              <PostCard post={post} />
            ))}
          </div>
        )
      }
    </main>
  </div>
</PageLayout>

<script>
  // Check if user is admin and show/hide admin actions
  const isAdmin = localStorage.getItem('isAdmin');
  const newPostButton = document.getElementById('new-post-button');
  const firstPostButton = document.getElementById('first-post-button');

  if (isAdmin === 'true') {
    newPostButton?.classList.remove('hidden');
    firstPostButton?.classList.remove('hidden');
  }
</script>
