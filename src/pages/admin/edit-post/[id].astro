---
import Layout from '../../../layouts/PageLayout.astro';
import AdminNavigation from '../../../components/admin/AdminNavigation.astro';
import PostForm from '../../../components/admin/PostForm.astro';
import PostFormHandler from '../../../components/admin/PostFormHandler.astro';
import {getDB} from '../../../lib/db';

// Get the post ID from the URL params
const {id} = Astro.params;

// Fetch the post from the database
const db = getDB();
const post = db.getPostById(Number(id));

// If post not found, return 404
if (!post) {
  return Astro.redirect('/404');
}

const metadata = {
  title: `Edit: ${post.title}`,
};
---

<Layout metadata={metadata}>
  <div class="min-h-screen bg-background">
    <AdminNavigation backUrl={`/posts/${post.slug}`} backText="Back to post" />

    <!-- Form -->
    <main class="container mx-auto px-6 py-16 max-w-4xl">
      <div class="max-w-2xl">
        <h1 class="text-4xl md:text-6xl font-bold text-primary mb-12">Edit Post</h1>

        <PostForm post={post} mode="edit" />
        <PostFormHandler mode="edit" postId={post.id} />
      </div>
    </main>
  </div>
</Layout>
