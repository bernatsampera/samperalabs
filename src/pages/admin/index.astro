---
import Button from '~/components/ui/Button.astro';
import Layout from '../../layouts/Layout.astro';

const metadata = {
  title: 'Admin',
};
---

<Layout metadata={metadata}>
  <div class="container mx-auto px-6 py-16 max-w-md">
    <div id="login-form" class="bg-card border rounded-lg p-6">
      <h1 class="text-2xl font-bold mb-6 text-center">Admin Login</h1>
      <form id="admin-login-form" class="space-y-4">
        <div>
          <label for="password" class="block text-sm font-medium mb-2">Password</label>
          <input
            type="password"
            id="password"
            name="password"
            class="w-full px-3 py-2 border rounded-md bg-background text-foreground"
            required
          />
        </div>
        <button
          type="submit"
          class="w-full px-4 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 transition-colors"
        >
          Login
        </button>
      </form>
      <div id="error-message" class="mt-4 text-red-500 text-sm hidden"></div>
    </div>

    <div id="admin-panel" class="bg-card border rounded-lg p-6 hidden">
      <h1 class="text-2xl font-bold mb-6 text-center">Admin Panel</h1>
      <p class="text-center text-muted-foreground mb-6">You are now logged in as admin.</p>
      <div class="space-y-4">
        <a
          href="/blog"
          class="block w-full px-4 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 transition-colors text-center"
        >
          Go to Blog
        </a>
        <Button href="/admin/new-post" text="Create New Post" class="w-full" />
        <button
          id="logout-btn"
          class="w-full px-4 py-2 bg-destructive text-destructive-foreground rounded-md hover:bg-destructive/90 transition-colors"
        >
          Logout
        </button>
      </div>
    </div>
  </div>
</Layout>

<script>
  // Check if user is already logged in
  const isAdmin = localStorage.getItem('isAdmin');
  const loginForm = document.getElementById('login-form');
  const adminPanel = document.getElementById('admin-panel');

  if (isAdmin === 'true') {
    loginForm?.classList.add('hidden');
    adminPanel?.classList.remove('hidden');
  }

  // Handle login form submission
  document.getElementById('admin-login-form')?.addEventListener('submit', (e) => {
    e.preventDefault();

    const formData = new FormData(e.target as HTMLFormElement);
    const password = formData.get('password') as string;
    const errorMessage = document.getElementById('error-message');

    // Replace 'admin123' with your desired password
    if (password === 'admin123') {
      localStorage.setItem('isAdmin', 'true');
      loginForm?.classList.add('hidden');
      adminPanel?.classList.remove('hidden');
      errorMessage?.classList.add('hidden');
    } else {
      errorMessage!.textContent = 'Invalid password. Please try again.';
      errorMessage?.classList.remove('hidden');
    }
  });

  // Handle logout
  document.getElementById('logout-btn')?.addEventListener('click', () => {
    localStorage.removeItem('isAdmin');
    adminPanel?.classList.add('hidden');
    loginForm?.classList.remove('hidden');

    // Clear the password field
    const passwordField = document.getElementById('password') as HTMLInputElement;
    if (passwordField) passwordField.value = '';

    // Hide error message
    document.getElementById('error-message')?.classList.add('hidden');
  });
</script>
