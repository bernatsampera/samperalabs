---
import Logo from '~/components/Logo.astro';
import {getHomePermalink} from '~/utils/permalinks';

interface Link {
  text?: string;
  href?: string;
}

export interface Props {
  links?: Array<Link>;
  isSticky?: boolean;
}

const {links = [], isSticky = false} = Astro.props;

const currentPath = new URL(Astro.url).pathname;

function isActive(href: string | undefined): boolean {
  if (!href) return false;
  // Exact match
  if (currentPath === href) return true;
  // Blog tab should also be active on /posts/* and /tags/*
  if (href === '/blog' && (currentPath.startsWith('/posts') || currentPath.startsWith('/tags'))) return true;
  // About tab should also be active on /about subpaths
  if (href === '/about' && currentPath.startsWith('/about')) return true;
  // References tab should also be active on /references/* subpaths
  if (href === '/references' && currentPath.startsWith('/references')) return true;
  return false;
}
---

<header
  class:list={[
    {sticky: isSticky, relative: !isSticky},
    'top-0 z-40 w-full transition-all ease-in-out py-6',
    isSticky ? 'shadow-sm bg-background' : 'bg-transparent',
  ]}
  {...isSticky ? {'data-sticky-header': true} : {}}
>
  <div class="mx-auto px-6">
    <div class="flex justify-between items-center">
      <a class="text-2xl font-bold tracking-tighter" href={getHomePermalink()}>
        <Logo />
      </a>

      <nav>
        <ul class="flex space-x-10 text-base">
          {
            links.map(({text, href}) => (
              <li>
                <a
                  class:list={[
                    'hover:opacity-70 transition-colors duration-300',
                    isActive(href) ? 'font-medium underline underline-offset-4' : '',
                  ]}
                  href={href}
                >
                  {text}
                </a>
              </li>
            ))
          }
        </ul>
      </nav>
    </div>
  </div>
</header>
