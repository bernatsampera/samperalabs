---
import EditorToolbar from './EditorToolbar.astro';
import EditorStyles from './editor/EditorStyles.astro';
---

<div class="tiptap-editor-container border rounded-sm">
  <EditorToolbar />
  <div id="tiptap-editor" class="tiptap-editor border-t"></div>
</div>

<EditorStyles />

<script>
  import {createTipTapEditor, createEventHandlers, setupKeyboardShortcuts} from '../../utils/editorUtils';

  let editor: any;
  let controller: any;

  document.addEventListener('DOMContentLoaded', async () => {
    const editorElement = document.getElementById('tiptap-editor');
    const contentTextarea = document.getElementById('content') as HTMLTextAreaElement;

    if (editorElement && contentTextarea) {
      const result = await createTipTapEditor(editorElement, contentTextarea);
      editor = result.editor;
      controller = result.controller;

      // Set up event callbacks for editor updates
      editor.on('update', () => controller.updateToolbarState());
      editor.on('selectionUpdate', () => controller.updateToolbarState());

      // Initialize toolbar handlers and keyboard shortcuts
      createEventHandlers(controller);
      setupKeyboardShortcuts(controller);
    }
  });
</script>
